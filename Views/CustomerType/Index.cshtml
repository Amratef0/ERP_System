@model IEnumerable<CustomerTypeVM>
@{
    ViewData["Title"] = "Customer Types";
    string currentSearch = Context.Request.Query["searchByName"];
}

<div class="page-section">

    <!-- Header -->
    <div class="bp-header">
        <h1>Customer Types</h1>
        <p>Manage Customer Types</p>
    </div>

    <!-- Search Card -->
    <div class="bp-search-card top-search mt-4">
        <form method="get" asp-controller="CustomerType" asp-action="Index" class="bp-search-form">
            <div class="bp-search-group">
                <i class="bi bi-search"></i>
                <input type="text" name="searchByName" value="@currentSearch" placeholder="Search byCustomerType Name..." />
            </div>
            <button type="submit">Search</button>
        </form>
    </div>

    <!-- Stats Row (optional, هنا ممكن تحطي إحصائيات لو حابة) -->
    <div class="bp-stats-row mt-4">
        <div class="bp-stat-card stat-1">
            <div>
                <h3>@Model.Count()</h3>
                <p>Total Customer Types</p>
            </div>
            <i class="bi bi-collection"></i>
        </div>
    </div>

    <!-- Customer Types Table -->
    <div class="list-page departments-page mt-4">
        <div class="card">
            <h2>Customer Types List</h2>

            <!-- Floating Add Button -->
            <a href="javascript:void(0)" 
               onclick="openModalWithAjax('@Url.Action("Create", "CustomerType")', 'Add New Customer Type')" 
               class="floating-btn" 
               title="Add New Customer Type">
               <i class="fa-solid fa-plus"></i>
            </a>



            <table>
                <thead>
                    <tr>
                        <th>Type Name</th>
                        <th>Description</th>
                        <th>Customers</th>
                        <th>Actions</th>
                    </tr>
                </thead>

                <tbody id="customerTypes">
                    @if (Model != null && Model.Any())
                    {
                        foreach (var type in Model)
                        {
                            <tr>
                                <td data-label="Type Name"><strong>@type.Name</strong></td>
                                <td data-label="Description">
                                    <span class="text-muted text-truncate" style="max-width:360px;">
                                        @(string.IsNullOrEmpty(type.Description) ? "-" : (type.Description.Length > 50 ? type.Description.Substring(0,50) + "..." : type.Description))
                                    </span>
                                </td>
                                <td data-label="Customers">@type.CustomerCount</td>
                                <td data-label="Actions">
                                    <div class="action-buttons">
                                        <a href="javascript:void(0)"
                                           onclick="openModalWithAjax('@Url.Action("Edit", "CustomerType", new { id = type.Id })', 'Edit Customer Type')"
                                           class="btn btn-update btn-sm"
                                           title="Edit Customer Type">
                                            <i class="fa-solid fa-pen"></i>
                                        </a>

                                        <a href="javascript:void(0)"
                                           onclick="openModalWithAjax('@Url.Action("Delete", "CustomerType", new { id = type.Id })', 'Delete Customer Type')"
                                           class="btn btn-delete btn-sm"
                                           title="Delete Customer Type">
                                            <i class="fa-solid fa-trash"></i>
                                        </a>

                                    </div>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="4" class="text-center py-4 text-muted">No customer types found.</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<link rel="stylesheet" href="@(Url.Content("~/css/ListPageHeader.css"))" />
<link rel="stylesheet" href="@(Url.Content("~/css/CRUD/Index.css"))" />
<link rel="stylesheet" href="@(Url.Content("~/css/pagination.css"))" />
@await Html.PartialAsync("_GeneralModal")
