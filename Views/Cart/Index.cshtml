
@model CartVM
@{
    ViewData["Title"] = "Shopping Cart";
}

<div class="container-fluid py-4">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h2 mb-1 text-primary fw-bold">Shopping Cart</h1>
            <p class="text-muted mb-0">Review your items and proceed to checkout</p>
        </div>
        <div>
            <a asp-controller="Market" asp-action="Index" class="btn btn-outline-primary">
                <i class="bi bi-arrow-left me-2"></i>Continue Shopping
            </a>
        </div>
    </div>

    @if (Model.productsCart.Any())
    {
        <div class="row">
            <!-- Cart Items -->
            <div class="col-lg-8">
                <div class="card shadow-sm border-0">
                    <div class="card-header bg-light py-3 border-0">
                        <h4 class="card-title mb-0 fw-semibold text-dark">
                            Cart Items (@Model.productsCart.Count)
                        </h4>
                    </div>
                    <div class="card-body p-0">
                        @foreach (var product in Model.productsCart)
                        {
                            <div class="cart-item border-bottom p-4">
                                <div class="row align-items-center">
                                    <!-- Product Image -->
                                    <div class="col-md-2">
                                        <a asp-controller="Market" asp-action="ProductDetails" asp-route-productId="@product.Id">
                                            <img src="@product.ImageURL" alt="@product.Name"
                                                 class="img-fluid rounded-3" style="height: 100px; object-fit: cover;">
                                        </a>
                                    </div>

                                    <!-- Product Details -->
                                    <div class="col-md-4">
                                        <a asp-controller="Market" asp-action="ProductDetails" asp-route-productId="@product.Id" class="text-decoration-none text-dark">
                                            <h6 class="fw-bold mb-2">@product.Name</h6>
                                        </a>

                                        <!-- Pricing -->
                                        <div class="d-flex align-items-center gap-2">
                                            @if (product.HaveOffer)
                                            {
                                                <span class="h6 fw-bold text-success mb-0">$@product.NetPrice.ToString("N2")</span>
                                                <span class="text-muted text-decoration-line-through small">$@product.Price.ToString("N2")</span>
                                                <span class="badge bg-danger rounded-pill">Save @product.DiscountPercentage%</span>
                                            }
                                            else
                                            {
                                                <span class="h6 fw-bold text-dark mb-0">$@product.Price.ToString("N2")</span>
                                            }
                                        </div>
                                    </div>

                                    <!-- Quantity Display -->
                                    <div class="col-md-3">
                                        <div class="d-flex align-items-center">
                                            <span class="fw-semibold text-muted">Quantity: @product.Quantity</span>
                                        </div>
                                    </div>

                                    <!-- Total Price & Actions -->
                                    <div class="col-md-3">
                                        <div class="d-flex align-items-center justify-content-between">
                                            <div class="text-end">
                                                <span class="h6 fw-bold text-dark">
                                                    $@((product.NetPrice * product.Quantity).ToString("N2"))
                                                </span>
                                                <div class="text-muted small">
                                                    $@product.NetPrice.ToString("N2") each
                                                </div>
                                            </div>
                                            <form method="post" asp-action="Delete" class="ms-3">
                                                <input type="hidden" name="productId" value="@product.Id" />
                                                @Html.AntiForgeryToken()
                                                <button type="submit" class="btn btn-outline-danger btn-sm">
                                                    <i class="bi bi-trash"></i>
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Order Summary -->
            <div class="col-lg-4">
                <div class="card shadow-sm border-0 sticky-top" style="top: 2rem;">
                    <div class="card-header bg-light py-3 border-0">
                        <h4 class="card-title mb-0 fw-semibold text-dark">Order Summary</h4>
                    </div>
                    <div class="card-body">
                        <!-- Summary Details -->
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-muted">Subtotal</span>
                                <span class="fw-semibold">$@Model.TotalPrice.ToString("N2")</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-muted">Shipping</span>
                                <span class="fw-semibold">$0.00</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-muted">Tax</span>
                                <span class="fw-semibold">$0.00</span>
                            </div>
                            <hr>
                            <div class="d-flex justify-content-between mb-3">
                                <span class="h5 fw-bold text-dark">Total</span>
                                <span class="h5 fw-bold text-primary">$@Model.TotalPrice.ToString("N2")</span>
                            </div>
                        </div>

                        <!-- Checkout Button -->
                        <button class="btn btn-primary btn-lg w-100 mb-3" data-bs-toggle="modal" data-bs-target="#paymentModal">
                            <i class="bi bi-lock-fill me-2"></i>Proceed to Checkout
                        </button>

                        <!-- Additional Info -->
                        <div class="text-center">
                            <small class="text-muted">
                                <i class="bi bi-shield-check me-1"></i>
                                Secure checkout â€¢ 30-day money back guarantee
                            </small>
                        </div>
                    </div>
                </div>

               
            </div>
        </div>

        <!-- Payment Method Modal -->
        <div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title fw-bold" id="paymentModalLabel">Select Payment Method</h4>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row g-3">
                            <!-- Cash on Delivery Option -->
                            <div class="col-12">
                                <div class="card payment-option-card" data-payment-type="cash">
                                    <div class="card-body p-4">
                                        <div class="d-flex align-items-center">
                                            <div class="flex-shrink-0">
                                                <i class="bi bi-wallet2 display-6 text-success"></i>
                                            </div>
                                            <div class="flex-grow-1 ms-4">
                                                <h6 class="fw-bold mb-1">Cash on Delivery</h6>
                                                <p class="text-muted mb-0">Pay when your order arrives at your doorstep</p>
                                            </div>
                                            <div class="flex-shrink-0">
                                                <i class="bi bi-check-circle-fill text-success payment-check" style="font-size: 1.5rem; display: none;"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Online Payment Option -->
                            <div class="col-12">
                                <div class="card payment-option-card" data-payment-type="online">
                                    <div class="card-body p-4">
                                        <div class="d-flex align-items-center">
                                            <div class="flex-shrink-0">
                                                <i class="bi bi-credit-card display-6 text-primary"></i>
                                            </div>
                                            <div class="flex-grow-1 ms-4">
                                                <h6 class="fw-bold mb-1">Online Payment</h6>
                                                <p class="text-muted mb-0">Pay securely with your credit/debit card</p>
                                            </div>
                                            <div class="flex-shrink-0">
                                                <i class="bi bi-check-circle-fill text-primary payment-check" style="font-size: 1.5rem; display: none;"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                        <a id="proceedWithCash" asp-controller="Order" asp-action="MakeOrder" class="btn btn-success" style="display: none;">
                            <i class="bi bi-wallet2 me-2"></i>Proceed with Cash
                        </a>
                        <a id="proceedWithOnline" href="@Url.Action("ProcessPayment", "Payment")" class="btn btn-primary">
                            <i class="bi bi-credit-card me-2"></i>Proceed to Payment
                        </a>

                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <!-- Empty Cart -->
        <div class="card shadow-sm border-0">
            <div class="card-body text-center py-5">
                <i class="bi bi-cart-x display-1 text-muted d-block mb-4"></i>
                <h3 class="text-muted mb-3">Your cart is empty</h3>
                <p class="text-muted mb-4">Looks like you haven't added any items to your cart yet.</p>
                <a asp-controller="Market" asp-action="Index" class="btn btn-primary btn-lg">
                    <i class="bi bi-bag me-2"></i>Start Shopping
                </a>
            </div>
        </div>
    }
</div>

<link rel="stylesheet" href="@(Url.Content("~/css/cart.css"))" />


@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Payment option selection
            const paymentOptionCards = document.querySelectorAll('.payment-option-card');
            const proceedWithCash = document.getElementById('proceedWithCash');
            const proceedWithOnline = document.getElementById('proceedWithOnline');

            paymentOptionCards.forEach(card => {
                card.addEventListener('click', function() {
                    // Remove selected class from all cards
                    paymentOptionCards.forEach(c => {
                        c.classList.remove('selected');
                        c.querySelector('.payment-check').style.display = 'none';
                    });

                    // Add selected class to clicked card
                    this.classList.add('selected');
                    this.querySelector('.payment-check').style.display = 'block';

                    // Show appropriate proceed button
                    const paymentType = this.getAttribute('data-payment-type');
                    if (paymentType === 'cash') {
                        proceedWithCash.style.display = 'inline-block';
                        proceedWithOnline.style.display = 'none';
                    } else if (paymentType === 'online') {
                        proceedWithCash.style.display = 'none';
                        proceedWithOnline.style.display = 'inline-block';
                    }
                });
            });
        });
    </script>
}
