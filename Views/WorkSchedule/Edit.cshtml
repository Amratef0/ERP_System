@model WorkScheduleDayVM

@{
    ViewData["Title"] = "Edit Work Schedule Day";
}

<link rel="stylesheet" href="~/css/CRUD/Create.css" />

<div class="form-page mt-4">
    <div class="form">
        <h3 class="formTitle" id="form-title">
            <i class="bi bi-pencil-square"></i> Edit Work Schedule Day
        </h3>

        <form asp-action="Edit" method="post" novalidate>
            @Html.AntiForgeryToken()

            <!-- Hidden fields -->
            <input asp-for="Id" type="hidden" />
            <input asp-for="WorkScheduleId" type="hidden" />

            <!-- Day Field -->
            <div class="form-group">
                <input asp-for="Day" class="form-control" placeholder=" " readonly />
                <label asp-for="Day">Day of Week</label>
                <span asp-validation-for="Day" class="text-danger"></span>
            </div>

            <!-- Is Work Day -->
            <div class="form-group form-check">
                <input asp-for="IsWorkDay" id="IsWorkDay" type="checkbox" class="form-check-input" />
                <label asp-for="IsWorkDay" for="IsWorkDay" class="form-check-label">
                     This is a Work Day
                </label>
            </div>


            <!-- Work Time Section -->
            <div id="workTimeSection">

                <!-- Start Time -->
                <div class="number-field-group">
                    <label for="WorkStartTime" class="number-label">
                        <i class="bi bi-clock"></i> Work Start Time
                    </label>
                    <div style="display:flex; gap:8px; align-items:center;">
                        <input type="time" asp-for="WorkStartTime" class="number-input" id="WorkStartTime" />
                        <button id="clearStartTimeBtn" type="button" class="btn-clear-special">
                            <i class="bi bi-x-circle"></i>
                        </button>
                    </div>
                    <span asp-validation-for="WorkStartTime" class="text-danger"></span>
                    <span class="form-text">Time when work begins (e.g., 09:00)</span>
                </div>
                <br />

                <!-- End Time -->
                <div class="number-field-group">
                    <label for="WorkEndTime" class="number-label">
                        <i class="bi bi-clock-history"></i> Work End Time
                    </label>
                    <div style="display:flex; gap:8px; align-items:center;">
                        <input type="time" asp-for="WorkEndTime" class="number-input" id="WorkEndTime" />
                        <button id="clearEndTimeBtn" type="button" class="btn-clear-special">
                            <i class="bi bi-x-circle"></i>
                        </button>
                    </div>
                    <span asp-validation-for="WorkEndTime" class="text-danger"></span>
                    <span class="form-text">Time when work ends (e.g., 17:00)</span>
                </div>

                <!-- Duration -->
                <div class="form-group full-width">
                    <div class="symbol-preview-box">
                        <div class="symbol-preview-content">
                            <i class="bi bi-hourglass-split symbol-icon"></i>
                            <div>
                                <p class="symbol-title">Work Duration</p>
                                <p id="durationDisplay" class="symbol-text">-</p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Buttons -->
            <div class="form-buttons">
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-check-circle"></i> Update
                </button>
                <a asp-action="Index" class="btn btn-secondary">
                    <i class="bi bi-x-circle"></i> Cancel
                </a>
            </div>

        </form>
    </div>
    <!-- Work Schedule Info -->
<div class="lists-section" style="margin-top:22px;">
    <h4>Schedule Information</h4>

    <ul class="item-list">
        <li><strong>Work Days:</strong> Days when employees are expected to work</li>
        <li><strong>Off Days:</strong> Regular days off (typically weekends)</li>
        <li><strong>Start/End Times:</strong> Standard working hours for each work day</li>
        <li><strong>Duration:</strong> Total hours per work day</li>
        <li><strong>Weekly Hours:</strong> Total working hours per week</li>
    </ul>
</div>
</div>




@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        document.getElementById('clearStartTimeBtn')?.addEventListener('click', function() {
            document.getElementById('WorkStartTime').value = '';
            calculateDuration();
        });

        document.getElementById('clearEndTimeBtn')?.addEventListener('click', function() {
            document.getElementById('WorkEndTime').value = '';
            calculateDuration();
        });

        const isWorkDayCheckbox = document.getElementById('IsWorkDay');
        const workTimeSection = document.getElementById('workTimeSection');

        function toggleWorkTime() {
            workTimeSection.style.display = isWorkDayCheckbox.checked ? 'block' : 'none';
        }

        isWorkDayCheckbox?.addEventListener('change', toggleWorkTime);
        toggleWorkTime();

        function calculateDuration() {
            const startTime = document.getElementById('WorkStartTime').value;
            const endTime = document.getElementById('WorkEndTime').value;
            const durationDisplay = document.getElementById('durationDisplay');

            if (startTime && endTime) {
                const start = new Date('1970-01-01T' + startTime);
                const end = new Date('1970-01-01T' + endTime);
                const diff = end - start;

                if (diff > 0) {
                    const hours = Math.floor(diff / 3600000);
                    const minutes = Math.floor((diff % 3600000) / 60000);
                    durationDisplay.textContent = `${hours}h ${minutes}m`;
                    durationDisplay.className = 'text-success mb-0';
                } else {
                    durationDisplay.textContent = 'Invalid times';
                    durationDisplay.className = 'text-danger mb-0';
                }
            } else {
                durationDisplay.textContent = '-';
                durationDisplay.className = 'text-muted mb-0';
            }
        }

        document.getElementById('WorkStartTime')?.addEventListener('change', calculateDuration);
        document.getElementById('WorkEndTime')?.addEventListener('change', calculateDuration);
        calculateDuration();
    </script>
}
