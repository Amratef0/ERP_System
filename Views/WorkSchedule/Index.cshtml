@model IEnumerable<WorkScheduleDay>

@{
    ViewData["Title"] = "Work Schedule";
}

<div class="page-section">

    <!-- Header -->
    <div class="bp-header">
        <h2>Work Schedule</h2>
        <p>Manage weekly work schedule and working hours</p>
    </div>

    <!-- Stats Row -->
    <div class="bp-stats-row mt-4">
        <div class="bp-stat-card stat-1">
            <div>
                <h3>@Model.Count(d => d.IsWorkDay)</h3>
                <p>Work Days</p>
            </div>
            <i class="bi bi-calendar-check"></i>
        </div>

        <div class="bp-stat-card stat-2">
            <div>
                @{
                    var totalHours = 0;
                    foreach (var day in Model.Where(d => d.IsWorkDay))
                    {
                        if (day.WorkStartTime.HasValue && day.WorkEndTime.HasValue)
                        {
                            totalHours += (int)(day.WorkEndTime.Value - day.WorkStartTime.Value).TotalHours;
                        }
                    }
                }
                <h3>@totalHours hrs</h3>
                <p>Weekly Hours</p>
            </div>
            <i class="bi bi-hourglass-split"></i>
        </div>

        <div class="bp-stat-card stat-3">
            <div>
                <h3>@Model.Count(d => !d.IsWorkDay)</h3>
                <p>Off Days</p>
            </div>
            <i class="bi bi-calendar-x"></i>
           
        </div>

        <div class="bp-stat-card stat-4">
             <div>
                <h3>@Model.Count()</h3>
                <p>Total Days</p>
            </div>
            <i class="bi bi-clock"></i>
        </div>
    </div>

    <!-- Work Schedule Table -->
    <div class="list-page work-schedule-page mt-4">
        <div class="card">
            <h2>Weekly Schedule</h2>

            <table>
                <thead>
                    <tr>
                        <th>Day</th>
                        <th class="text-center">Work Day</th>
                        <th>Start Time</th>
                        <th>End Time</th>
                        <th class="text-center">Duration</th>
                        <th class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        var dayClass = item.IsWorkDay ? "" : "table-secondary";
                        var duration = "";
                        if (item.IsWorkDay && item.WorkStartTime.HasValue && item.WorkEndTime.HasValue)
                        {
                            var hours = (item.WorkEndTime.Value - item.WorkStartTime.Value).TotalHours;
                            duration = $"{hours:F1} hrs";
                        }

                        <tr class="@dayClass">
                            <td><strong>@item.Day</strong></td>
                            <td class="text-center">
                                @if (item.IsWorkDay)
                                {
                                    <span class="status active">Work Day</span>
                                }
                                else
                                {
                                    <span class="status inactive">Day Off</span>
                                }
                            </td>
                            <td>
                                @if (item.IsWorkDay && item.WorkStartTime.HasValue)
                                {
                                    @item.WorkStartTime.Value.ToString(@"hh\:mm")
                                }
                                else
                                {
                                    <span class="text-muted">-</span>
                                }
                            </td>
                            <td>
                                @if (item.IsWorkDay && item.WorkEndTime.HasValue)
                                {
                                    @item.WorkEndTime.Value.ToString(@"hh\:mm")
                                }
                                else
                                {
                                    <span class="text-muted">-</span>
                                }
                            </td>
                            <td class="text-center">
                                @if (!string.IsNullOrEmpty(duration))
                                {
                                    <span class="status info">@duration</span>
                                }
                                else
                                {
                                    <span class="text-muted">-</span>
                                }
                            </td>
                            <td class="text-center">
                                <div class="action-buttons">
                                    <a asp-action="Edit" asp-route-id="@item.Id" 
                                       class="btn btn-update btn-sm" title="Edit Schedule">
                                       <i class="fa-solid fa-pen"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>

            @if (!Model.Any())
            {
                <div class="alert alert-info mt-4">
                    <i class="bi bi-info-circle"></i> No work schedule found.
                </div>
            }
        </div>


    </div>

</div>

<link rel="stylesheet" href="@(Url.Content("~/css/ListPageHeader.css"))" />
<link rel="stylesheet" href="@(Url.Content("~/css/CRUD/Index.css"))" />

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
